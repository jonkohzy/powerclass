<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<link rel="stylesheet" href="../stylesheets/common.css" type="text/css">
	<link rel="stylesheet" href="../stylesheets/nav.css" type="text/css">
	<link rel="stylesheet" href="../stylesheets/school-matters.css" type="text/css">
	<title>PowerClass | CIP Records</title>  
	<style>
		td, tr{
			background: white;
		}
		.left{
			border-top-left-radius: 10px;
			border-bottom-left-radius: 10px;
		}
		.right{
			border-top-right-radius: 10px;
			border-bottom-right-radius: 10px;
		}
	</style>
</head>
<body>
    <div class="header">
		<a href = "../dashboard.html" class="name">PowerClass</a>
		<a href="../outstanding-work.html" class="header-item outstanding-work-navlink">Outstanding Work</a>
		<a class="header-item school-matters-navlink">School Matters</a>
		<a href="../message-board.html" class="header-item message-board-navlink">Message Board</a>

		<div class="user">
			<img class="icon" src="../img/user.png" alt="profile picture" onclick="show_profile();">
		</div>
	</div>
	<!--header end-->

	<!--navbar-->
	<div class="navi">
		<a href="announcements.html">Announcements</a>
		<a class="selected" href="cip.html">CIP</a>
		<a href="discipline.html">Discipline</a>
		<a href="events.html">Events</a>
		<a href="exams.html">Exams</a>
		<a href="particulars.html">Particulars</a>
		<a href="project-work.html">Project Work</a>
	</div>
	<!--navbar end-->

	<div class = "content", style = "
		height: 550px;
		background: linear-gradient(120deg, #12b59f 25%, transparent 25%);
	">
		<h2 class="no-records">No CIP records found.</h2>
		<div id="totalCipHours" class="number">Loading...</div>

		<table class="list" style = "border-spacing: 0px 10px">
			<thead>
				<tr>
					<th class = 'left'>Activity Name</th>
					<th>Organisation</th>
					<th>Type</th>
					<th>Period</th>
					<th>Role</th>
					<th>Hours</th>
					<th class = 'right'>Status</th>
				</tr>
			</thead>
		</table>
	</div>

	<script>
		fetch("/api/isp/cip", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({
				user: "171290r",
				pass: "jkjk1234",
			}),
		})
		.then((res) => {
			const requestStatusElem = document.getElementById("totalCipHoursHeading");
			const largeNumber = document.getElementById("totalCipHours");
			switch (res.status) {
				case 500:
					requestStatusElem.textContent = "An internal error occurred.";
					largeNumber.style.display = "none";
					break;
				case 401:
					requestStatusElem.textContent = "Invalid username or password.";
					largeNumber.style.display = "none";
					break;
				case 200:
					return res.json();

				default:
					requestStatusElem.textContent = "An unknown error occurred.";
					largeNumber.style.display = "none";
			}
		})
		.then((cipData) => {
			if (!cipData) return; // error already handled above

			const { totalCipHours, activities } = cipData;
			document.getElementById("totalCipHours").textContent = totalCipHours + "h";
			if (activities.length) {
				const table = document.getElementsByClassName("list")[0];
				activities.forEach(({ activityName,	organisation, type,	period, role,	hours, status	}) => {
					const row = document.createElement("tr");

					const activityCell = document.createElement("td");
					activityCell.textContent = activityName;
					activityCell.className = "left";
					const organisationCell = document.createElement("td");
					organisationCell.textContent = organisation;
					const typeCell = document.createElement("td");
					typeCell.textContent = type;
					const periodCell = document.createElement("td");
					periodCell.textContent = period;
					const roleCell = document.createElement("td");
					roleCell.textContent = role;
					const hoursCell = document.createElement("td");
					hoursCell.textContent = hours;
					const statusCell = document.createElement("td");
					statusCell.textContent = status;
					statusCell.className = "right";

					row.appendChild(activityCell);
					row.appendChild(organisationCell);
					row.appendChild(typeCell);
					row.appendChild(periodCell);
					row.appendChild(roleCell);
					row.appendChild(hoursCell);
					row.appendChild(statusCell);

					table.appendChild(row);
				});
			} else {
				document.getElementsByClassName("no-records")[0].style.display = "block";
			}
		})
	</script>
</body>
</html>