<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<link rel="stylesheet" href="../stylesheets/common.css" type="text/css">
	<link rel="stylesheet" href="../stylesheets/nav.css" type="text/css">
	<link rel="stylesheet" href="../stylesheets/school-matters.css" type="text/css">
	<title>PowerClass | Discipline Records</title>
</head>
<body>
    <div class="header">
		<a href = "../dashboard.html" class="name">PowerClass</a>

		<a href="../outstanding-work.html" class="header-item outstanding-work-navlink">Outstanding Work</a>
		<a class="header-item school-matters-navlink">School Matters</a>
		<a href="../message-board.html" class="header-item message-board-navlink">Message Board</a>

		<div class="user">
			<img class="icon" src="../img/user.png" alt="profile picture" onclick="show_profile();">
		</div>
	</div>
	<!--header end-->
	<!--navbar-->
	<div class="navi">
		<a href="announcements.html">Announcements</a>
		<a href="cip.html">CIP</a>
		<a class="selected" href="discipline.html">Discipline</a>
		<a href="events.html">Events</a>
		<a href="exams.html">Exams</a>
		<a href="particulars.html">Particulars</a>
		<a href="project-work.html">Project Work</a>
	</div>
	<div class = "content">
		<h1 class = "heading">Demerit Points</h1>
		<div class = "number">Loading...</div>
		<table class = "list">
			<thead>
				<tr>
					<th>Category</th>
					<th>Offense</th>
					<th>Date</th>
					<th>Demerit Points</th>
					<th>Major Offence?</th>
				</tr>
			</thead>
		</table>
	</div>
	<!-- weird fix for transitions firing on page load -->
	<script>
		fetch("/api/isp/discipline", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({
				user: "171255n",
				pass: "@cptaHadk0"
			}),
		}).then((res) => res.json()).then(({ totalDemeritPoints, disciplineRecords }) => {
			const Tdp = document.getElementsByClassName("number")[0];
			Tdp.textContent = totalDemeritPoints;
			const BODY = document.getElementsByClassName("list")[0];
			disciplineRecords.forEach(({category, offence, date, demeritPoints, majorOffence}) => {
				const ROW = document.createElement("tr");
				const CAT = document.createElement("td");
				CAT.textContent = category;
				const OFF = document.createElement("td");
				OFF.textContent = offence;
				const DAY = document.createElement("td");
				DAY.textContent = date;
				const DP = document.createElement("td");
				DP.textContent = `${demeritPoints} DP`;
				const MAJOR = document.createElement("td");
				if(majorOffence){
					MAJOR.textContent = "Yes";
				}else{
					MAJOR.textContent = "No";
				}
				ROW.appendChild(CAT);
				ROW.appendChild(OFF);
				ROW.appendChild(DAY);
				ROW.appendChild(DP);
				ROW.appendChild(MAJOR);
				BODY.appendChild(ROW);
			});
			if(disciplineRecords.length === 0){
				const ROW = document.createElement("tr");
				const TEXT = document.createElement("td");
				TEXT.textContent = "Hooray! You have no discipline records";
				TEXT.colSpan = "5";
				TEXT.style.width = "100%";
				ROW.appendChild(TEXT);
				BODY.appendChild(ROW);
			}
		});
	</script>
</body>
</html>