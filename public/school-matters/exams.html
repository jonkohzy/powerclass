<!DOCTYPE html>
<html lang="en" style = "height: 100%">
<head>
  <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<link rel="stylesheet" href="../stylesheets/common.css" type="text/css">
	<link rel="stylesheet" href="../stylesheets/nav.css" type="text/css">
	<link rel="stylesheet" href="../stylesheets/school-matters.css" type="text/css">
	<link rel="stylesheet" href="dropdown.css" type="text/css">
	<title>PowerClass | Exam Results</title>
	<style>
		.button{
			margin-top: 100px;
		}
		button{
			width: 200px;
			font-family:inherit;
			background: transparent;
			position: relative;
			display: block;
			color: white;
			font-size: 14px;
			text-decoration: none;
			border: 2px solid #fc5185;
			padding: 21px 20px;
			text-transform: uppercase;
			overflow: hidden;
			transition: 1s all ease;
			z-index: 2;
		}
		button::before{
			background: #fc5185;
			content: "";
			height: 100%;
			width: 0;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: -1;
			transition: all 0.6s ease;
		}
		button:hover::before{
			width: 100%;
		}
		.content div{
			float: left;
			width: 50%;
		}
	</style>
</head>
<body style = "height: 100%">
    <div class="header">
		<a href = "../dashboard.html" class="name">PowerClass</a>
		<a href="../outstanding-work.html" class="header-item outstanding-work-navlink">Outstanding Work</a>
		<a class="header-item school-matters-navlink">School Matters</a>
		<a href="../message-board.html" class="header-item message-board-navlink">Message Board</a>

		<div class="user">
			<img class="icon" src="../img/user.png" alt="profile picture" onclick="show_profile();">
		</div>
	</div>
	<!--header end-->
	<!--navbar-->
	<div class="navi">
		<a href="announcements.html">Announcements</a>
		<a href="cip.html">CIP</a>
		<a href="discipline.html">Discipline</a>
		<a href="events.html">Events</a>
		<a class="selected" href="exams.html">Exams</a>
		<a href="particulars.html">Particulars</a>
		<a href="project-work.html">Project Work</a>
	</div>
	<div class = "content">
		<div>
		<h1 class = "heading">Exams</h1>
		<div class = "select">
			<input class="chosen-value" type="text" value="" placeholder="Loading...">
			<ul style = "padding-left: 0px" class = "value-list">
			</ul>
			<div class = "button">
				<button onClick=show()>Check your results</button>
			</div>
			
		</div>
		<table style = "margin-top: 50px" cellspacing = "10">

		</table>
		</div>
		<div>
			<h1 class = "heading">Reports</h1>
			<div class = "select">
				<input class="chosen-value" type="text" value="" placeholder="Loading...">
				<ul style = "padding-left: 0px" class = "value-list">
				</ul>
				<div class = "button">
					<button onClick=download()>Download your reports</button>
				</div>
				
			</div>
			<table style = "margin-top: 50px" cellspacing = "10">
	
			</table>
		</div>
	</div>
	<!-- weird fix for transitions firing on page load -->
	<script>
		let Results;
		let Reports;
		fetch("/api/isp/exams", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({
				user: "171290r",
				pass: "jkjk1234"
			}),
		}).then((res) => res.json()).then(({examResults, reports }) => {
			console.log(reports);
			Results = examResults
			Reports = reports;
			const SELECT = document.getElementsByClassName("value-list")[0];
			examResults.forEach(results => {
				const OPTION = document.createElement("li");
				OPTION.textContent = results.exam;
				OPTION.className = "one";
				SELECT.appendChild(OPTION);
			});
			drop();
			const SELECT2 = document.getElementsByClassName("value-list")[1];
			reports.forEach(reports =>{
				const OPTION = document.createElement("li");
				OPTION.textContent = reports.reportName;
				OPTION.className = "two";
				SELECT2.appendChild(OPTION);
			});
			drop2();
		});
		const show = () => {
			const inputField = document.getElementsByClassName("chosen-value")[0];
			Results.forEach((element) =>{
				if(inputField.value === element.exam){
					const TABLE = document.getElementsByTagName("table")[0];
					while(TABLE.firstChild){
						TABLE.removeChild(TABLE.firstChild);
					}
					element.results.forEach((elem) => {
						const ROW = document.createElement("tr");
						const SUBJECT = document.createElement("td");
						SUBJECT.textContent = elem.subject;
						const MARK = document.createElement("td");
						MARK.textContent = elem.mark;
						ROW.appendChild(SUBJECT);
						ROW.appendChild(MARK);
						TABLE.appendChild(ROW);
					});
				}
			});
		}
		const download = () => {
			const inputField2 = document.getElementsByClassName("chosen-value")[1];
			Reports.forEach((report) => {
				if(inputField2.value === report.reportName){
					window.open(`/api/isp/get-file?user=MTcxMjU1bg==&pass=QGNwdGFIYWRrMA==&fileLink=${report.reportUrl}`)
				}
			});
		}
	</script>
	<script src = "dropdown.js"></script>
</body>
</html>